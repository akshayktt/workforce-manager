<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WorkForce Manager</title>
    <style>
      html, body { height: 100%; margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
      body { background: linear-gradient(135deg, #0f2e42, #1b4965, #2d6a8f); }
      #root { display: flex; height: 100%; flex: 1; }
      .container { display: flex; justify-content: center; align-items: center; height: 100vh; width: 100%; }
      .card { background: white; border-radius: 12px; padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); max-width: 400px; width: 90%; }
      .header { text-align: center; margin-bottom: 30px; }
      .header h1 { color: #1b4965; margin: 0 0 10px 0; font-size: 28px; }
      .header p { color: #666; margin: 0; }
      .form-group { margin-bottom: 20px; }
      .form-input { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
      .form-input:focus { outline: none; border-color: #2d6a8f; }
      .btn { width: 100%; padding: 12px; background: #2d6a8f; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: background 0.3s; }
      .btn:hover { background: #1b4965; }
      .btn:disabled { background: #ccc; cursor: not-allowed; }
      .error { color: #e74c3c; margin-top: 10px; padding: 10px; background: #fff5f5; border-radius: 6px; }
      .success { color: #27ae60; margin-top: 10px; padding: 10px; background: #f0fff4; border-radius: 6px; }
      .demo-accounts { margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
      .demo-accounts h3 { font-size: 14px; color: #666; margin: 0 0 10px 0; text-align: center; }
      .demo-btn { display: inline-block; margin: 5px; padding: 8px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 12px; cursor: pointer; transition: background 0.3s; }
      .demo-btn:hover { background: #e9ecef; }
      .loading { text-align: center; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #2d6a8f; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 10px auto; }
      .feature-card { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 1.5rem; cursor: pointer; transition: all 0.3s; }
      .feature-card:hover { background: #e9ecef; box-shadow: 0 4px 8px rgba(0,0,0,0.15); transform: translateY(-2px); }
      .feature-card h3 { margin: 0 0 1rem 0; color: #1b4965; font-size: 18px; }
      .feature-card p { margin: 0; color: #666; font-size: 14px; }
    </style>
</head>
<body>
    <div id="root">
        <div class="container">
            <div class="card">
                <div class="header">
                    <h1>WorkForce Manager</h1>
                    <p>Project & Labor Management</p>
                </div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <input type="text" id="username" class="form-input" placeholder="Username" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="password" class="form-input" placeholder="Password" required>
                    </div>
                    <button type="submit" class="btn" id="loginBtn">Sign In</button>
                </form>
                
                <div id="message"></div>
                
                <div class="demo-accounts">
                    <h3>Demo Accounts</h3>
                    <div style="text-align: center;">
                        <span class="demo-btn" onclick="fillCredentials('admin', 'admin123')">Admin</span>
                        <span class="demo-btn" onclick="fillCredentials('supervisor1', 'super123')">Supervisor</span>
                        <span class="demo-btn" onclick="fillCredentials('labor1', 'labor123')">Labor</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Login form handling
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('message');
            const loginBtn = document.getElementById('loginBtn');
            
            if (!username || !password) {
                showMessage('Please enter both username and password', 'error');
                return;
            }
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<div class="spinner"></div>';
            messageDiv.innerHTML = '';
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`Welcome, ${data.fullName}!`, 'success');
                    window.currentUser = data; // Store user data globally
                    setTimeout(() => {
                        showDashboard(data);
                    }, 1500);
                } else {
                    showMessage(data.message || 'Login failed', 'error');
                }
            } catch (error) {
                showMessage('Network error. Please try again.', 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = 'Sign In';
            }
        });
        
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="${type}">${text}</div>`;
        }
        
        function fillCredentials(user, pass) {
            document.getElementById('username').value = user;
            document.getElementById('password').value = pass;
        }
        
        function showDashboard(user) {
            const interfaceContent = getFullInterfaceForRole(user);
            document.getElementById('root').innerHTML = `
                <div style="min-height: 100vh; background: linear-gradient(135deg, #0f2e42, #1b4965, #2d6a8f);">
                    <nav style="background: rgba(255,255,255,0.95); padding: 1rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto;">
                            <div>
                                <h1 style="margin: 0; color: #1b4965; font-size: 24px;">WorkForce Manager</h1>
                                <p style="margin: 0; color: #666; font-size: 14px;">Welcome back, ${user.fullName}</p>
                            </div>
                            <button onclick="logout()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Logout</button>
                        </div>
                    </nav>
                    <div style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
                        ${interfaceContent}
                    </div>
                </div>
            `;
            // Load data for the specific role
            loadRoleData(user.role);
        }

        function getFullInterfaceForRole(user) {
            switch(user.role.toLowerCase()) {
                case 'admin':
                    return `
                        <div class="card" style="max-width: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                                <h2 style="color: #1b4965; margin: 0;">Admin Dashboard</h2>
                                <button onclick="showCreateUserModal()" class="btn" style="width: auto; padding: 8px 16px;">+ Create User</button>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #e74c3c;" id="pendingCount">-</div>
                                    <div style="color: #666; font-size: 14px;">Pending Requests</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #27ae60;" id="approvedCount">-</div>
                                    <div style="color: #666; font-size: 14px;">Approved Requests</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #6c757d;" id="totalUsers">-</div>
                                    <div style="color: #666; font-size: 14px;">Total Users</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                <button onclick="setAdminTab('pending')" id="pendingTab" class="btn" style="width: auto; padding: 8px 16px; background: #2d6a8f;">Pending Requests</button>
                                <button onclick="setAdminTab('approved')" id="approvedTab" class="btn" style="width: auto; padding: 8px 16px; background: #6c757d;">Approved</button>
                                <button onclick="setAdminTab('users')" id="usersTab" class="btn" style="width: auto; padding: 8px 16px; background: #6c757d;">Users</button>
                            </div>
                            
                            <div id="adminContent" style="min-height: 400px;">Loading...</div>
                        </div>`;
                
                case 'supervisor':
                    return `
                        <div class="card" style="max-width: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                                <h2 style="color: #1b4965; margin: 0;">Supervisor Dashboard</h2>
                                <button onclick="showRequestLaborModal()" class="btn" style="width: auto; padding: 8px 16px;">+ Request Labor</button>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #2d6a8f;" id="myProjectsCount">-</div>
                                    <div style="color: #666; font-size: 14px;">My Projects</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #e74c3c;" id="myRequestsCount">-</div>
                                    <div style="color: #666; font-size: 14px;">Labor Requests</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                <button onclick="setSupervisorTab('projects')" id="projectsTab" class="btn" style="width: auto; padding: 8px 16px; background: #2d6a8f;">Projects</button>
                                <button onclick="setSupervisorTab('requests')" id="requestsTab" class="btn" style="width: auto; padding: 8px 16px; background: #6c757d;">Labor Requests</button>
                            </div>
                            
                            <div id="supervisorContent" style="min-height: 400px;">Loading...</div>
                        </div>`;
                
                case 'labor':
                    return `
                        <div class="card" style="max-width: none;">
                            <h2 style="color: #1b4965; margin-bottom: 2rem;">Labor Dashboard</h2>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #27ae60;" id="activeAssignments">-</div>
                                    <div style="color: #666; font-size: 14px;">Active Assignments</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #f39c12;" id="pendingAssignments">-</div>
                                    <div style="color: #666; font-size: 14px;">Pending Assignments</div>
                                </div>
                            </div>
                            
                            <h3 style="color: #1b4965; margin-bottom: 1rem;">My Assignments</h3>
                            <div id="laborContent" style="min-height: 400px;">Loading...</div>
                        </div>`;
                
                default:
                    return '<div class="card"><h2>Invalid Role</h2><p>Contact administrator.</p></div>';
            }
        }

        function showPage(page) {
            // Here you would implement navigation to different pages
            // For now, we'll show a placeholder
            const content = getPageContent(page);
            document.querySelector('[style*="max-width: 1200px"]').innerHTML = `
                <div class="card" style="max-width: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: #1b4965; margin: 0;">${getPageTitle(page)}</h2>
                        <button onclick="showDashboard(window.currentUser)" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">‚Üê Back to Dashboard</button>
                    </div>
                    ${content}
                </div>
            `;
        }

        function getPageTitle(page) {
            const titles = {
                'users': 'User Management',
                'projects': 'Project Management', 
                'labor-requests': 'Labor Requests',
                'reports': 'Reports & Analytics',
                'my-projects': 'My Projects',
                'team-labor': 'Team & Labor',
                'request-labor': 'Request Labor',
                'project-reports': 'Project Reports',
                'my-assignments': 'My Assignments',
                'time-tracking': 'Time Tracking',
                'availability': 'Availability',
                'profile': 'My Profile'
            };
            return titles[page] || 'Page';
        }

        function getPageContent(page) {
            // Placeholder content for different pages
            // In a real app, this would load actual page content/components
            switch(page) {
                case 'users':
                    return `<div style="text-align: center; padding: 3rem;">
                        <h3>üë• User Management</h3>
                        <p>This page would show user management functionality including:</p>
                        <ul style="text-align: left; max-width: 400px; margin: 0 auto;">
                            <li>Create/Edit/Delete users</li>
                            <li>Assign roles and permissions</li>
                            <li>View user activity</li>
                            <li>Manage user profiles</li>
                        </ul>
                    </div>`;
                case 'projects':
                    return `<div style="text-align: center; padding: 3rem;">
                        <h3>üìã Project Management</h3>
                        <p>This page would show project management features:</p>
                        <ul style="text-align: left; max-width: 400px; margin: 0 auto;">
                            <li>Create new projects</li>
                            <li>Assign supervisors</li>
                            <li>Track project progress</li>
                            <li>Manage project resources</li>
                        </ul>
                    </div>`;
                case 'request-labor':
                    return `<div style="text-align: center; padding: 3rem;">
                        <h3>üôã‚Äç‚ôÇÔ∏è Request Labor</h3>
                        <div style="max-width: 500px; margin: 0 auto; text-align: left;">
                            <form style="background: #f8f9fa; padding: 2rem; border-radius: 8px;">
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Project:</label>
                                    <select class="form-input">
                                        <option>Select Project...</option>
                                        <option>Construction Project A</option>
                                        <option>Renovation Project B</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Labor Type:</label>
                                    <select class="form-input">
                                        <option>Select Type...</option>
                                        <option>General Labor</option>
                                        <option>Skilled Worker</option>
                                        <option>Equipment Operator</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Number of Workers:</label>
                                    <input type="number" class="form-input" min="1" value="1">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Start Date:</label>
                                    <input type="date" class="form-input">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Description:</label>
                                    <textarea class="form-input" rows="3" placeholder="Describe the work requirements..."></textarea>
                                </div>
                                <button type="submit" class="btn">Submit Request</button>
                            </form>
                        </div>
                    </div>`;
                default:
                    return `<div style="text-align: center; padding: 3rem;">
                        <h3>${getPageTitle(page)}</h3>
                        <p>This page is under development.</p>
                        <p>Content for "${page}" would be implemented here.</p>
                    </div>`;
            }
        }

        function logout() {
            if(confirm('Are you sure you want to logout?')) {
                window.currentUser = null;
                location.reload();
            }
        }

        // Load role-specific data
        async function loadRoleData(role) {
            switch(role.toLowerCase()) {
                case 'admin':
                    await loadAdminData();
                    setAdminTab('pending');
                    break;
                case 'supervisor':
                    await loadSupervisorData();
                    setSupervisorTab('projects');
                    break;
                case 'labor':
                    await loadLaborData();
                    break;
            }
        }

        // Admin functions
        async function loadAdminData() {
            try {
                const [usersRes, requestsRes] = await Promise.all([
                    fetch('/api/users'),
                    fetch('/api/labor-requests')
                ]);
                
                if (usersRes.ok) {
                    const users = await usersRes.json();
                    document.getElementById('totalUsers').textContent = users.length;
                }
                
                if (requestsRes.ok) {
                    const requests = await requestsRes.json();
                    const pending = requests.filter(r => r.status === 'pending').length;
                    const approved = requests.filter(r => r.status === 'approved').length;
                    document.getElementById('pendingCount').textContent = pending;
                    document.getElementById('approvedCount').textContent = approved;
                    window.adminRequests = requests;
                }
            } catch (error) {
                console.error('Failed to load admin data:', error);
            }
        }

        function setAdminTab(tab) {
            // Update tab styles
            document.querySelectorAll('[id$="Tab"]').forEach(btn => {
                btn.style.background = '#6c757d';
            });
            document.getElementById(tab + 'Tab').style.background = '#2d6a8f';
            
            // Show content for tab
            const content = document.getElementById('adminContent');
            switch(tab) {
                case 'pending':
                    showAdminRequests('pending');
                    break;
                case 'approved':
                    showAdminRequests('approved');
                    break;
                case 'users':
                    showAdminUsers();
                    break;
            }
        }

        function showAdminRequests(status) {
            const requests = (window.adminRequests || []).filter(r => r.status === status);
            const content = document.getElementById('adminContent');
            
            if (requests.length === 0) {
                content.innerHTML = `<div style="text-align: center; padding: 3rem; color: #666;">No ${status} requests found</div>`;
                return;
            }
            
            content.innerHTML = requests.map(request => `
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4 style="margin: 0 0 0.5rem 0; color: #1b4965;">Project: ${request.projectName || 'N/A'}</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">Supervisor: ${request.supervisorName || 'N/A'}</p>
                            <p style="margin: 0; color: #666; font-size: 14px;">Labor: ${request.laborName || 'N/A'}</p>
                            <p style="margin: 0; color: #666; font-size: 14px;">Period: ${formatDate(request.startDate)} - ${formatDate(request.endDate)}</p>
                        </div>
                        ${status === 'pending' ? `
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="approveRequest('${request.id}')" style="background: #27ae60; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Approve</button>
                            <button onclick="rejectRequest('${request.id}')" style="background: #e74c3c; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Reject</button>
                        </div>
                        ` : `<span style="color: #27ae60; font-weight: bold;">‚úì ${status.toUpperCase()}</span>`}
                    </div>
                </div>
            `).join('');
        }

        function showAdminUsers() {
            const content = document.getElementById('adminContent');
            content.innerHTML = '<div style="text-align: center; padding: 3rem;">üë• User management interface would be implemented here</div>';
        }

        // Supervisor functions
        async function loadSupervisorData() {
            try {
                const [projectsRes, requestsRes] = await Promise.all([
                    fetch('/api/projects'),
                    fetch('/api/labor-requests')
                ]);
                
                if (projectsRes.ok) {
                    const projects = await projectsRes.json();
                    document.getElementById('myProjectsCount').textContent = projects.length;
                    window.supervisorProjects = projects;
                }
                
                if (requestsRes.ok) {
                    const requests = await requestsRes.json();
                    document.getElementById('myRequestsCount').textContent = requests.length;
                    window.supervisorRequests = requests;
                }
            } catch (error) {
                console.error('Failed to load supervisor data:', error);
            }
        }

        function setSupervisorTab(tab) {
            // Update tab styles
            document.querySelectorAll('[id$="Tab"]').forEach(btn => {
                btn.style.background = '#6c757d';
            });
            document.getElementById(tab + 'Tab').style.background = '#2d6a8f';
            
            // Show content for tab
            const content = document.getElementById('supervisorContent');
            switch(tab) {
                case 'projects':
                    showSupervisorProjects();
                    break;
                case 'requests':
                    showSupervisorRequests();
                    break;
            }
        }

        function showSupervisorProjects() {
            const projects = window.supervisorProjects || [];
            const content = document.getElementById('supervisorContent');
            
            if (projects.length === 0) {
                content.innerHTML = '<div style="text-align: center; padding: 3rem; color: #666;">No projects assigned</div>';
                return;
            }
            
            content.innerHTML = projects.map(project => `
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #1b4965;">${project.name}</h4>
                    <p style="margin: 0; color: #666; font-size: 14px;">${project.description || 'No description'}</p>
                    <p style="margin: 0.5rem 0 0 0; color: #666; font-size: 12px;">Created: ${formatDate(project.createdAt)}</p>
                </div>
            `).join('');
        }

        function showSupervisorRequests() {
            const requests = window.supervisorRequests || [];
            const content = document.getElementById('supervisorContent');
            
            if (requests.length === 0) {
                content.innerHTML = '<div style="text-align: center; padding: 3rem; color: #666;">No labor requests found</div>';
                return;
            }
            
            content.innerHTML = requests.map(request => `
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4 style="margin: 0 0 0.5rem 0; color: #1b4965;">Project: ${request.projectName || 'N/A'}</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">Labor: ${request.laborName || 'N/A'}</p>
                            <p style="margin: 0; color: #666; font-size: 14px;">Period: ${formatDate(request.startDate)} - ${formatDate(request.endDate)}</p>
                        </div>
                        <span style="color: ${getStatusColor(request.status)}; font-weight: bold;">${request.status.toUpperCase()}</span>
                    </div>
                </div>
            `).join('');
        }

        // Labor functions
        async function loadLaborData() {
            try {
                const requestsRes = await fetch('/api/labor-requests');
                if (requestsRes.ok) {
                    const requests = await requestsRes.json();
                    const active = requests.filter(r => r.status === 'approved').length;
                    const pending = requests.filter(r => r.status === 'pending').length;
                    
                    document.getElementById('activeAssignments').textContent = active;
                    document.getElementById('pendingAssignments').textContent = pending;
                    
                    showLaborAssignments(requests);
                }
            } catch (error) {
                console.error('Failed to load labor data:', error);
            }
        }

        function showLaborAssignments(requests) {
            const content = document.getElementById('laborContent');
            
            if (requests.length === 0) {
                content.innerHTML = '<div style="text-align: center; padding: 3rem; color: #666;">No assignments found</div>';
                return;
            }
            
            const active = requests.filter(r => r.status === 'approved');
            const pending = requests.filter(r => r.status === 'pending');
            
            let html = '';
            
            if (active.length > 0) {
                html += '<h4 style="color: #27ae60; margin-bottom: 1rem;">‚úì Active Assignments</h4>';
                html += active.map(request => `
                    <div style="background: #f0fff4; border-left: 4px solid #27ae60; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #1b4965;">${request.projectName || 'Project N/A'}</h4>
                        <p style="margin: 0; color: #666; font-size: 14px;">Supervisor: ${request.supervisorName || 'N/A'}</p>
                        <p style="margin: 0; color: #666; font-size: 14px;">Period: ${formatDate(request.startDate)} - ${formatDate(request.endDate)}</p>
                        <p style="margin: 0.5rem 0 0 0; color: #27ae60; font-size: 12px; font-weight: bold;">ACTIVE</p>
                    </div>
                `).join('');
            }
            
            if (pending.length > 0) {
                html += '<h4 style="color: #f39c12; margin: 2rem 0 1rem 0;">‚è≥ Pending Assignments</h4>';
                html += pending.map(request => `
                    <div style="background: #fff8dc; border-left: 4px solid #f39c12; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #1b4965;">${request.projectName || 'Project N/A'}</h4>
                        <p style="margin: 0; color: #666; font-size: 14px;">Supervisor: ${request.supervisorName || 'N/A'}</p>
                        <p style="margin: 0; color: #666; font-size: 14px;">Period: ${formatDate(request.startDate)} - ${formatDate(request.endDate)}</p>
                        <p style="margin: 0.5rem 0 0 0; color: #f39c12; font-size: 12px; font-weight: bold;">PENDING APPROVAL</p>
                    </div>
                `).join('');
            }
            
            content.innerHTML = html;
        }

        // Helper functions
        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric', 
                year: 'numeric'
            });
        }

        function getStatusColor(status) {
            switch(status) {
                case 'approved': return '#27ae60';
                case 'rejected': return '#e74c3c';
                case 'pending': return '#f39c12';
                default: return '#6c757d';
            }
        }

        // Modal functions (placeholder)
        function showCreateUserModal() {
            alert('Create User modal would be implemented here');
        }

        function showRequestLaborModal() {
            alert('Request Labor modal would be implemented here');
        }

        function approveRequest(requestId) {
            alert(`Approve request ${requestId} - API call would be implemented here`);
        }

        function rejectRequest(requestId) {
            alert(`Reject request ${requestId} - API call would be implemented here`);
        }
        
        // Test API on page load
        fetch('/api/auth/me')
            .then(response => console.log('API Health Check:', response.status === 401 ? 'Working (Not authenticated)' : 'Working'))
            .catch(() => console.log('API connection issue'));
    </script>
</body>
</html>